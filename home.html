<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Russian Pronunciation Master</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .lesson-card {
            background: rgba(255,255,255,0.95);
            color: #2c3e50;
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        .stress-explanation {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            font-size: 1.2em;
            line-height: 1.6;
        }
        
        .word-display {
            font-size: 4em;
            font-weight: bold;
            color: #e74c3c;
            margin: 30px 0;
            letter-spacing: 0.1em;
        }
        
        .rhythm-pattern {
            font-size: 2.5em;
            color: #3498db;
            margin: 20px 0;
            font-family: monospace;
            font-weight: bold;
        }
        
        .word-image {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .cat-illustration {
            font-size: 6em;
            position: relative;
        }
        
        .cat-illustration::before {
            content: "üëÅÔ∏èüëÅÔ∏è";
            position: absolute;
            top: -20px;
            left: -10px;
            font-size: 0.3em;
        }
        
        .comet-illustration {
            font-size: 4em;
            position: relative;
        }
        
        .comet-illustration::before {
            content: "‚ú®";
            position: absolute;
            top: -10px;
            left: -30px;
            font-size: 0.5em;
            animation: sparkle 1s infinite;
        }
        
        .comet-illustration::after {
            content: "‚ú®";
            position: absolute;
            bottom: -10px;
            right: -30px;
            font-size: 0.4em;
            animation: sparkle 1.5s infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        
        .mama-illustration {
            font-size: 4em;
            position: relative;
        }
        
        .mama-illustration::before {
            content: "üíï";
            position: absolute;
            top: -15px;
            right: -20px;
            font-size: 0.4em;
            animation: heartbeat 2s infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .interaction-panel {
            background: #34495e;
            border-radius: 15px;
            padding: 30px;
            margin: 25px 0;
            color: white;
        }
        
        .microphone-btn {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: none;
            font-size: 3em;
            cursor: pointer;
            margin: 20px;
            transition: all 0.3s;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        
        .mic-listen {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }
        
        .mic-recording {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .play-btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 100px;
            height: 100px;
            font-size: 2.5em;
            cursor: pointer;
            margin: 15px;
            transition: all 0.3s;
        }
        
        .play-btn:hover {
            transform: scale(1.1);
        }
        
        .feedback {
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-size: 1.2em;
            text-align: center;
        }
        
        .feedback.success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
        }
        
        .feedback.correction {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }
        
        .step-instruction {
            background: rgba(52, 152, 219, 0.1);
            border-left: 4px solid #3498db;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            font-size: 1.1em;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
        }
        
        .nav-btn {
            background: #34495e;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .nav-btn:hover {
            background: #2c3e50;
        }
        
        .nav-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        
        .hidden {
            display: none;
        }
        
        .molodets-explanation {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Stress Explanation -->
        <div class="lesson-card">
            <div class="stress-explanation">
                Here's the secret of Russian pronunciation: each Russian word has only ONE stress. 
                The stressed syllable is pronounced a bit longer than others, with emphasis. 
                This is crucial not only for speaking correctly, but also for understanding others when they speak!
            </div>
            <button class="play-btn" onclick="playStressExplanation()">üîä</button>
        </div>

        <!-- Word Practice: –ú–ê–ú–ê -->
        <div id="mama-practice" class="lesson-card">
            <div class="word-image">
                <div class="mama-illustration">üë©‚Äçüëß</div>
            </div>
            
            <div class="word-display">–ú–êÃÅ–ú–ê</div>
            
            <div class="step-instruction">Look at the word above, then listen to the rhythm pattern:</div>
            
            <div class="rhythm-pattern">–¢–êÃÅ-—Ç–∞</div>
            <button class="play-btn" onclick="playRhythm('–¢–êÃÅ-—Ç–∞')">üéµ</button>
            
            <div class="interaction-panel">
                <div class="step-instruction">Now try to read the word into the microphone:</div>
                <button id="micBtn1" class="microphone-btn mic-listen" onclick="startRecording('–º–∞–º–∞', 'mama-practice')">üé§</button>
                <div id="feedback1" class="feedback hidden"></div>
            </div>
        </div>

        <!-- Word Practice: –ö–û–ú–ï–¢–ê -->
        <div id="cometa-practice" class="lesson-card hidden">
            <div class="word-image">
                <div class="comet-illustration">‚òÑÔ∏è</div>
            </div>
            
            <div class="word-display">–ö–û–ú–ïÃÅ–¢–ê</div>
            
            <div class="step-instruction">Look at the word above, then listen to the rhythm pattern:</div>
            
            <div class="rhythm-pattern">—Ç–∞-–¢–êÃÅ-—Ç–∞</div>
            <button class="play-btn" onclick="playRhythm('—Ç–∞-–¢–êÃÅ-—Ç–∞')">üéµ</button>
            
            <div class="interaction-panel">
                <div class="step-instruction">Now try to read the word into the microphone:</div>
                <button id="micBtn2" class="microphone-btn mic-listen" onclick="startRecording('–∫–æ–º–µ—Ç–∞', 'cometa-practice')">üé§</button>
                <div id="feedback2" class="feedback hidden"></div>
            </div>
        </div>

        <!-- Word Practice: –¢–û–ú -->
        <div id="tom-practice" class="lesson-card hidden">
            <div class="word-image">
                <div class="cat-illustration">üê±</div>
            </div>
            
            <div class="word-display">–¢–û–ú</div>
            
            <div class="step-instruction">Single syllable - no rhythm pattern needed:</div>
            
            <div class="interaction-panel">
                <div class="step-instruction">Now try to read the word into the microphone:</div>
                <button id="micBtn3" class="microphone-btn mic-listen" onclick="startRecording('—Ç–æ–º', 'tom-practice')">üé§</button>
                <div id="feedback3" class="feedback hidden"></div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <button class="nav-btn" onclick="previousWord()" id="prevBtn">‚Üê Previous</button>
            <button class="nav-btn" onclick="nextWord()" id="nextBtn">Next ‚Üí</button>
        </div>

        <!-- Molodets explanation (shown once) -->
        <div id="molodets-explanation" class="molodets-explanation hidden">
            "–ú–æ–ª–æ–¥–µ—Ü" (molodets) means "well done" or "good job" in Russian. 
            Russians love to encourage each other with this word!
        </div>
    </div>
    
    <script>
        // Configuration
        const ELEVENLABS_API_KEY = 'sk_65a1ba422c3245fc8cca3df62a85b603727e749448b7f252';
        const VOICE_ID = 'EXAVITQu4vr4xnSDxMaL';
        
        let currentWord = 0;
        const words = ['mama-practice', 'cometa-practice', 'tom-practice'];
        const wordData = {
            '–º–∞–º–∞': { stress: 'MA-ma', rhythm: '–¢–êÃÅ-—Ç–∞' },
            '–∫–æ–º–µ—Ç–∞': { stress: 'ko-ME-ta', rhythm: '—Ç–∞-–¢–êÃÅ-—Ç–∞' },
            '—Ç–æ–º': { stress: 'TOM', rhythm: '–¢–û–ú' }
        };
        
        let recognition = null;
        let currentRecordingWord = '';
        let currentStep = 'listen';
        let molodetsExplained = false;
        
        // Show specific word practice
        function showWord(index) {
            document.querySelectorAll('.lesson-card').forEach((card, i) => {
                if (i === 0) return; // Skip stress explanation
                card.classList.toggle('hidden', i - 1 !== index);
            });
            
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === words.length - 1;
        }
        
        function nextWord() {
            if (currentWord < words.length - 1) {
                currentWord++;
                showWord(currentWord);
            }
        }
        
        function previousWord() {
            if (currentWord > 0) {
                currentWord--;
                showWord(currentWord);
            }
        }
        
        // Audio functions with proper Russian pronunciation
        async function playRussianWord(word) {
            // Force Russian pronunciation by using Cyrillic and language hints
            const russianText = word.replace(/–º–∞–º–∞/g, '–º–∞ÃÅ–º–∞')
                                   .replace(/–∫–æ–º–µ—Ç–∞/g, '–∫–æ–º–µÃÅ—Ç–∞')
                                   .replace(/—Ç–æ–º/g, '—Ç–æ–º');
            
            try {
                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`, {
                    method: 'POST',
                    headers: {
                        'Accept': 'audio/mpeg',
                        'Content-Type': 'application/json',
                        'xi-api-key': ELEVENLABS_API_KEY
                    },
                    body: JSON.stringify({
                        text: russianText,
                        model_id: 'eleven_multilingual_v2',
                        voice_settings: {
                            stability: 0.8,
                            similarity_boost: 0.9,
                            style: 0.0,
                            use_speaker_boost: true
                        },
                        pronunciation_dictionary_locators: []
                    })
                });
                
                if (response.ok) {
                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audio = new Audio(audioUrl);
                    audio.play();
                } else {
                    fallbackRussianSpeech(russianText);
                }
            } catch (error) {
                fallbackRussianSpeech(russianText);
            }
        }
        
        function fallbackRussianSpeech(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ru-RU';
            utterance.rate = 0.6;
            utterance.pitch = 1.0;
            
            // Find the best Russian voice
            const voices = window.speechSynthesis.getVoices();
            const russianVoice = voices.find(voice => 
                voice.lang === 'ru-RU' && (voice.name.includes('Google') || voice.name.includes('Microsoft'))
            ) || voices.find(voice => voice.lang.startsWith('ru'));
            
            if (russianVoice) {
                utterance.voice = russianVoice;
            }
            
            window.speechSynthesis.speak(utterance);
        }
        
        async function playEnglishText(text) {
            try {
                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`, {
                    method: 'POST',
                    headers: {
                        'Accept': 'audio/mpeg',
                        'Content-Type': 'application/json',
                        'xi-api-key': ELEVENLABS_API_KEY
                    },
                    body: JSON.stringify({
                        text: text,
                        model_id: 'eleven_multilingual_v2',
                        voice_settings: {
                            stability: 0.7,
                            similarity_boost: 0.8,
                            style: 0.2,
                            use_speaker_boost: true
                        }
                    })
                });
                
                if (response.ok) {
                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioUrl);
                    const audio = new Audio(audioUrl);
                    audio.play();
                } else {
                    fallbackEnglishSpeech(text);
                }
            } catch (error) {
                fallbackEnglishSpeech(text);
            }
        }
        
        function fallbackEnglishSpeech(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            window.speechSynthesis.speak(utterance);
        }
        
        function playRhythm(pattern) {
            // Convert Russian rhythm pattern to speech
            let rhythmText = pattern.replace(/–¢–êÃÅ/g, 'TAH').replace(/—Ç–∞/g, 'tah').replace(/–¢–û–ú/g, 'TOM');
            
            const utterance = new SpeechSynthesisUtterance(rhythmText);
            utterance.lang = 'ru-RU';
            utterance.rate = 0.7;
            utterance.pitch = 1.2;
            
            // Find Russian voice for rhythm
            const voices = window.speechSynthesis.getVoices();
            const russianVoice = voices.find(voice => voice.lang.startsWith('ru'));
            if (russianVoice) {
                utterance.voice = russianVoice;
            }
            
            window.speechSynthesis.speak(utterance);
        }
        
        function playStressExplanation() {
            const text = "Here's the secret of Russian pronunciation: each Russian word has only ONE stress. The stressed syllable is pronounced a bit longer than others, with emphasis. This is crucial not only for speaking correctly, but also for understanding others when they speak!";
            playEnglishText(text);
        }
        
        // Speech recognition and correction system
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'ru-RU';
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript.toLowerCase();
                    handleSpeechResult(transcript);
                };
                
                recognition.onerror = function(event) {
                    showFeedback('Could not recognize speech. Please try again.', 'correction');
                    resetMicrophone();
                };
                
                recognition.onend = function() {
                    resetMicrophone();
                };
            }
        }
        
        function startRecording(word, practiceId) {
            if (!recognition) {
                initSpeechRecognition();
            }
            
            currentRecordingWord = word;
            
            // Update UI
            const micBtn = document.querySelector(`#${practiceId} .microphone-btn`);
            micBtn.classList.remove('mic-listen');
            micBtn.classList.add('mic-recording');
            
            // Start recording
            recognition.start();
        }
        
        function resetMicrophone() {
            document.querySelectorAll('.microphone-btn').forEach(btn => {
                btn.classList.remove('mic-recording');
                btn.classList.add('mic-listen');
            });
        }
        
        function handleSpeechResult(transcript) {
            console.log('User said:', transcript);
            
            // Show what user said
            showFeedback(`You said: "${transcript}"`, 'correction');
            
            // Automatic correction sequence
            setTimeout(() => {
                playCorrectPronunciation();
            }, 2000);
        }
        
        function playCorrectPronunciation() {
            showFeedback('Now listen to the correct pronunciation:', 'correction');
            
            setTimeout(() => {
                playRussianWord(currentRecordingWord);
                
                setTimeout(() => {
                    askForRepeat();
                }, 3000);
            }, 1000);
        }
        
        function askForRepeat() {
            showFeedback('Please try again - repeat after me:', 'correction');
            playEnglishText('Please try again - repeat after me');
            
            setTimeout(() => {
                playRussianWord(currentRecordingWord);
                
                setTimeout(() => {
                    givePraise();
                }, 3000);
            }, 2000);
        }
        
        function givePraise() {
            showFeedback('–ú–æ–ª–æ–¥–µ—Ü! Well done!', 'success');
            
            // Explain molodets if first time
            if (!molodetsExplained) {
                setTimeout(() => {
                    document.getElementById('molodets-explanation').classList.remove('hidden');
                    playEnglishText('Molodets means well done or good job in Russian. Russians love to encourage each other with this word!');
                    molodetsExplained = true;
                }, 2000);
            } else {
                playRussianWord('–º–æ–ª–æ–¥–µ—Ü');
            }
        }
        
        function showFeedback(text, type) {
            const currentPractice = words[currentWord];
            const feedbackNum = currentWord + 1;
            const feedback = document.getElementById(`feedback${feedbackNum}`);
            
            feedback.textContent = text;
            feedback.className = `feedback ${type}`;
            feedback.classList.remove('hidden');
            
            // Hide after 5 seconds
            setTimeout(() => {
                feedback.classList.add('hidden');
            }, 5000);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showWord(0);
            
            // Load voices
            if (window.speechSynthesis.onvoiceschanged !== undefined) {
                window.speechSynthesis.onvoiceschanged = function() {
                    console.log('Voices loaded');
                };
            }
            
            // Auto-play introduction
            setTimeout(() => {
                playStressExplanation();
            }, 2000);
        });
    </script>
</body>
</html>
