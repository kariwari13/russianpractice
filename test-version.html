<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Russian Phonetic Learning Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 500px;
            width: 100%;
            padding: 30px;
            text-align: center;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .progress {
            background: #f0f0f0;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, #4CAF50, #45a049);
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .module-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .module-btn {
            padding: 8px 15px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .module-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .module-btn:hover {
            border-color: #667eea;
        }

        .content-area {
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .word-display {
            font-size: 48px;
            font-weight: bold;
            color: #333;
            margin: 20px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .word-image {
            max-width: 150px;
            max-height: 150px;
            margin: 15px 0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #2196F3;
            color: white;
        }

        .btn-secondary:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .instruction {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 14px;
            line-height: 1.6;
            text-align: left;
        }

        .status {
            margin: 10px 0;
            font-weight: bold;
            min-height: 20px;
        }

        .status.success {
            color: #4CAF50;
        }

        .status.error {
            color: #f44336;
        }

        .status.info {
            color: #2196F3;
        }

        .letters-intro {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
            letter-spacing: 8px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .word-display {
                font-size: 36px;
            }
            
            .control-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 200px;
            }
            
            .letters-intro {
                font-size: 24px;
                letter-spacing: 4px;
            }
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .mic-animation {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Russian Phonetic Learning</h1>
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>

        <div class="module-nav">
            <button class="module-btn active" onclick="loadModule(1)">Module 1</button>
            <button class="module-btn" onclick="loadModule(2)">Module 2</button>
            <button class="module-btn" onclick="loadModule(3)">Module 3</button>
            <button class="module-btn" onclick="loadModule(4)">Module 4</button>
            <button class="module-btn" onclick="loadModule(5)">Module 5</button>
        </div>

        <div class="content-area">
            <div id="lettersIntro" class="letters-intro hidden"></div>
            <div id="wordDisplay" class="word-display"></div>
            <img id="wordImage" class="word-image hidden" alt="">
            <div class="control-buttons">
                <button id="listenBtn" class="btn btn-primary" onclick="playCurrentAudio()">üîä Listen</button>
                <button id="micBtn" class="btn btn-secondary" onclick="startRecording()">üé§ Speak</button>
                <button id="stopBtn" class="btn btn-danger hidden" onclick="stopCurrentAudio()">‚èπ Stop</button>
            </div>
            <div id="status" class="status"></div>
        </div>

        <div id="instruction" class="instruction hidden"></div>
    </div>

    <script>
        // Learning data structure
        const modules = {
            1: {
                letters: ['–ú', '–ê'],
                words: ['–ú–ê', '–ú–ê–ú–ê', '–ê–ú'],
                images: { '–ú–ê–ú–ê': 'mama.jpg' },
                instructions: [
                    "Welcome to Russian! We'll start with just two letters: –ú (like 'M') and –ê (like 'AH'). Click Listen to hear each word, then click Speak to practice!",
                    "Great job! You just learned your first Russian word: –ú–ê–ú–ê (mama)! This means 'mother' - just like in English!"
                ]
            },
            2: {
                letters: ['–ú', '–ê', '–ö'],
                words: ['–ö–ê', '–ê–ö', '–ú–ê–ö', '–ö–ê–ú', '–ö–ê–ö–ê', '–ú–ê–ö–ê–ö–ê'],
                images: { '–ú–ê–ö–ê–ö–ê': 'monkey.jpg' },
                instructions: [
                    "Now we add –ö (like 'K'). We can make new words using –ú, –ê, –ö only.",
                    "Haha! From –ú–ê–ú–ê to –ú–ê–ö–ê–ö–ê (monkey)! You've gone from mama to monkey - quite a jump!"
                ]
            },
            3: {
                letters: ['–ú', '–ê', '–ö', '–û'],
                words: ['–ú–û', '–ö–û', '–û–ú', '–û–ö', '–ú–û–ö', '–ö–û–ú–ê'],
                images: {},
                instructions: [
                    "Adding –û (like 'OH'). Notice how we build words only with letters we've learned: –ú, –ê, –ö, –û."
                ]
            },
            4: {
                letters: ['–ú', '–ê', '–ö', '–û', '–¢'],
                words: ['–¢–û', '–¢–ê', '–û–¢', '–ê–¢', '–¢–û–ú', '–ö–û–¢', '–ú–û–¢', '–¢–ê–ö', '–ö–ê–¢', '–ê–¢–û–ú', '–¢–ê–ö–¢', '–¢–û–ú–ê–¢', '–ê–¢–ê–ö–ê'],
                images: { 
                    '–ö–û–¢': 'cat.jpg', 
                    '–¢–û–ú': 'tom-cat.jpg', 
                    '–¢–û–ú–ê–¢': 'tomat.jpg', 
                    '–ê–¢–û–ú': 'atom.jpg' 
                },
                instructions: [
                    "Adding –¢ (like 'T'). Now we have –ú, –ê, –ö, –û, –¢ - enough for real words!"
                ]
            },
            5: {
                letters: ['–ú', '–ê', '–ö', '–û', '–¢', '–ï'],
                words: ['–ú–ï', '–¢–ï', '–ö–ï', '–ï–ú', '–ï–ö', '–ú–ï–¢–ê', '–¢–ï–ú–ê', '–ö–û–ú–ï–¢–ê', '–ú–ï–¢–ï–û'],
                images: { '–ö–û–ú–ï–¢–ê': 'comet.jpg' },
                instructions: [
                    "Finally, adding –ï (like 'YEH'). Complete alphabet introduction!",
                    "After –ö–û–ú–ï–¢–ê (comet), let me teach you about Russian rhythm! Russian uses a TA-ta pattern - one syllable is STRONG (TA) and others are weak (ta). In –ö–û–ú–ï–¢–ê, it's ko-ME-ta (ta-TA-ta). The middle syllable –ú–ï gets the stress - it's longer and louder. Every Russian word has exactly ONE stress - this is very important for sounding natural!"
                ]
            }
        };

        // Global state
        let currentModule = 1;
        let currentWordIndex = 0;
        let currentAudio = null;
        let recognition = null;
        let isRecording = false;

        // Initialize speech recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
            } else if ('SpeechRecognition' in window) {
                recognition = new SpeechRecognition();
            }

            if (recognition) {
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'ru-RU';

                recognition.onstart = function() {
                    setStatus('Listening... Speak now!', 'info');
                    document.getElementById('micBtn').classList.add('mic-animation');
                };

                recognition.onresult = function(event) {
                    const spokenText = event.results[0][0].transcript;
                    setStatus(`You said: ${spokenText}`, 'success');
                    
                    // Play correct pronunciation automatically
                    setTimeout(() => {
                        playCorrectPronunciation();
                    }, 1000);
                };

                recognition.onerror = function(event) {
                    setStatus('Speech recognition error. Try again!', 'error');
                    stopRecording();
                };

                recognition.onend = function() {
                    stopRecording();
                };
            }
        }

        // Audio management
        function stopCurrentAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
            }
            document.getElementById('stopBtn').classList.add('hidden');
        }

        function playAudioFile(filename, callback) {
            stopCurrentAudio();
            
            // For now, show alert as placeholder - you'll replace with actual audio files
            alert(`Playing: ${filename}`);
            
            if (callback) {
                setTimeout(callback, 1000); // Simulate audio duration
            }
            
            /* Uncomment when you add real audio files:
            currentAudio = new Audio(filename);
            document.getElementById('stopBtn').classList.remove('hidden');
            
            currentAudio.onended = function() {
                document.getElementById('stopBtn').classList.add('hidden');
                if (callback) callback();
            };
            
            currentAudio.onerror = function() {
                setStatus('Audio file not found', 'error');
                if (callback) callback();
            };
            
            currentAudio.play();
            */
        }

        // Text-to-speech using ElevenLabs API
        async function speakWithElevenLabs(text, callback) {
            try {
                const response = await fetch('https://api.elevenlabs.io/v1/text-to-speech/EXAVITQu4vr4xnSDxMaL', {
                    method: 'POST',
                    headers: {
                        'Accept': 'audio/mpeg',
                        'Content-Type': 'application/json',
                        'xi-api-key': 'sk_65a1ba422c3245fc8cca3df62a85b603727e749448b7f252'
                    },
                    body: JSON.stringify({
                        text: text,
                        model_id: 'eleven_multilingual_v2',
                        voice_settings: {
                            stability: 0.5,
                            similarity_boost: 0.8
                        }
                    })
                });

                if (response.ok) {
                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);
                    
                    stopCurrentAudio();
                    currentAudio = new Audio(audioUrl);
                    document.getElementById('stopBtn').classList.remove('hidden');
                    
                    currentAudio.onended = function() {
                        document.getElementById('stopBtn').classList.add('hidden');
                        URL.revokeObjectURL(audioUrl);
                        if (callback) callback();
                    };
                    
                    currentAudio.play();
                } else {
                    throw new Error('ElevenLabs API error');
                }
            } catch (error) {
                console.error('TTS Error:', error);
                setStatus('Speech synthesis not available', 'error');
                if (callback) callback();
            }
        }

        // Core functionality
        function setStatus(message, type = '') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        function updateProgress() {
            const totalWords = Object.values(modules).reduce((sum, module) => sum + module.words.length, 0);
            let completedWords = 0;
            
            for (let i = 1; i < currentModule; i++) {
                completedWords += modules[i].words.length;
            }
            completedWords += currentWordIndex;
            
            const progress = (completedWords / totalWords) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        function loadModule(moduleNum) {
            currentModule = moduleNum;
            currentWordIndex = 0;
            
            // Update module navigation
            document.querySelectorAll('.module-btn').forEach((btn, index) => {
                btn.classList.toggle('active', index + 1 === moduleNum);
            });
            
            // Show letters introduction
            showLettersIntroduction();
        }

        function showLettersIntroduction() {
            const module = modules[currentModule];
            const lettersIntro = document.getElementById('lettersIntro');
            const instruction = document.getElementById('instruction');
            
            lettersIntro.textContent = module.letters.join(' ');
            lettersIntro.classList.remove('hidden');
            
            document.getElementById('wordDisplay').textContent = '';
            document.getElementById('wordImage').classList.add('hidden');
            
            instruction.textContent = module.instructions[0];
            instruction.classList.remove('hidden');
            
            // Play letters introduction
            speakWithElevenLabs(module.letters.join(' '), () => {
                setTimeout(startModule, 2000);
            });
            
            updateProgress();
        }

        function startModule() {
            document.getElementById('lettersIntro').classList.add('hidden');
            currentWordIndex = 0;
            showCurrentWord();
        }

        function showCurrentWord() {
            const module = modules[currentModule];
            
            if (currentWordIndex >= module.words.length) {
                completeModule();
                return;
            }
            
            const word = module.words[currentWordIndex];
            document.getElementById('wordDisplay').textContent = word;
            
            // Show image if available
            const wordImage = document.getElementById('wordImage');
            if (module.images[word]) {
                wordImage.src = module.images[word];
                wordImage.classList.remove('hidden');
            } else {
                wordImage.classList.add('hidden');
            }
            
            setStatus('Click Listen to hear the word, then Speak to practice!', 'info');
            updateProgress();
        }

        function playCurrentAudio() {
            const module = modules[currentModule];
            const word = module.words[currentWordIndex];
            const filename = `${word.toLowerCase()}.mp3`;
            
            playAudioFile(filename);
        }

        function startRecording() {
            if (!recognition) {
                setStatus('Speech recognition not supported in this browser', 'error');
                return;
            }
            
            if (isRecording) return;
            
            isRecording = true;
            recognition.start();
        }

        function stopRecording() {
            isRecording = false;
            document.getElementById('micBtn').classList.remove('mic-animation');
            if (recognition) {
                recognition.stop();
            }
        }

        function playCorrectPronunciation() {
            const module = modules[currentModule];
            const word = module.words[currentWordIndex];
            
            speakWithElevenLabs(word, () => {
                setTimeout(nextWord, 1500);
            });
        }

        function nextWord() {
            currentWordIndex++;
            showCurrentWord();
        }

        function completeModule() {
            const module = modules[currentModule];
            
            // Show completion message
            document.getElementById('wordDisplay').textContent = '–ú–æ–ª–æ–¥–µ—Ü!';
            document.getElementById('wordImage').classList.add('hidden');
            
            // Play completion sound
            speakWithElevenLabs('–ú–æ–ª–æ–¥–µ—Ü!', () => {
                // Show special instructions for certain modules
                if (currentModule === 1 && module.instructions[1]) {
                    showInstruction(module.instructions[1]);
                } else if (currentModule === 2 && module.instructions[1]) {
                    showInstruction(module.instructions[1]);
                } else if (currentModule === 5 && module.instructions[1]) {
                    showInstruction(module.instructions[1]);
                }
                
                setStatus('Module completed! Choose another module or replay this one.', 'success');
            });
            
            updateProgress();
        }

        function showInstruction(text) {
            const instruction = document.getElementById('instruction');
            instruction.textContent = text;
            instruction.classList.remove('hidden');
        }

        function stopCurrentAudio() {
            stopCurrentAudio();
            stopRecording();
        }

        // Initialize the application
        window.onload = function() {
            initSpeechRecognition();
            loadModule(1);
        };
    </script>
</body>
</html>
